{
    "schemaVersion": "2.2",
    "description": "Create directory, sync from S3, fix permissions, run jar, and upload report.",
    "mainSteps": [
      {
        "action": "aws:runShellScript",
        "name": "RunTafReportScript",
        "inputs": {
          "runCommand": [
            "sudo mkdir -p /home/ubuntu/tafreports",
            "sudo chown -R ubuntu:ubuntu /home/ubuntu/tafreports",
            "sudo chmod -R 755 /home/ubuntu/tafreports",
            "sudo su - ubuntu -c 'aws s3 sync s3://sro-team-arm/TafReport/ /home/ubuntu/tafreports/'",
            "sudo su - ubuntu -c 'cd /home/ubuntu/tafreports && java -jar TafReportUtility.jar'",
            "sudo su - ubuntu -c 'cd /home/ubuntu/tafreports && echo '' >> TAFReports.csv && tail -n +1 TAFReport.csv >> TAFReports.csv'",
            "sudo su - ubuntu -c 'mv /home/ubuntu/tafreports/TAFReport.csv /home/ubuntu/tafreports/TAFReport-$HOSTNAME.csv'",
            "sudo su - ubuntu -c 'aws s3 cp /home/ubuntu/tafreports/TAFReports.csv s3://sro-team-arm/TafReport/TAFReports.csv'",
            "sudo su - ubuntu -c 'aws s3 cp /home/ubuntu/tafreports/TAFReport-$HOSTNAME.csv s3://sro-team-arm/TAFReports/'"
          ]
        }
      }
    ]
  }